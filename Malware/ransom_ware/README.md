# ransom_ware

## 機能
- ランサムウェア
- テスト用のため指定フォルダ(ここではC:\tmp)配下のみ暗号化
- カウントダウン
- 復号成功時とカウントダウン終了時に自己消去

## 処理
1. `AES-256-CBC`方式でファイルを暗号化。
2. 攻撃者は`RSA-2048`方式で生成した公開鍵を使ってAES鍵とIVを暗号化する。
3. 拡張子を`.locked`に変更。
4. 暗号化されたAES鍵とIVを連結し、base64でエンコードし、公開鍵で暗号化し、それをまたbase64エンコードしたものを画面に表示。
5. ターゲットは送金後、base64エンコードされた文字列を攻撃者へ送信する。
6. 攻撃者はbase64エンコードされた文字列をbase64デコードし、秘密鍵で復号する。それを再度base64エンコードした文字列をターゲットに共有。
7. ターゲットは攻撃者からの文字列を入力。
8. base64デコードし、32byte(AES鍵), 16byte(IV)に分ける。それぞれを使用し、復号。

## 実行までの手順
1. `keygen.sh`を実行し、生成された公開鍵を`ransom_ware.c`にペースト
2. ビルド
```powershell
cl.exe /O2 /MT /D_CRT_SECURE_NO_WARNINGS ransom_ware.c /link /subsystem:windows user32.lib gdi32.lib bcrypt.lib crypt32.lib gdi32.lib /out:ransom_ware.exe
```
3. `ransom_ware.exe`を実行すると、画面に`Personal installation key`が表示
4. 時間内に`decrypt.sh`を実行し、`Personal installation key`を入力
5. 4で得た復号コードを入力

## ナレッジ
- Windows専用のGUIアプリは`WinMain`がエントリーポイントとなる。また、コンソールを出さないようにするためでもある。
- `CALLBACK`はWindows OSから呼び出す関数という意味の宣言。